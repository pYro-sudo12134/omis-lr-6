<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" th:href="@{/dashboard}">‚Ü© –ù–∞–∑–∞–¥</a>
        <span class="navbar-text text-white">
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏
        </span>
    </div>
</nav>

<div class="container">
    <h1 class="mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏</h1>

    <div th:if="${param.message}" class="alert alert-info">
        <span th:text="${param.message}"></span>
    </div>

    <div th:if="${param.error}" class="alert alert-danger">
        –û—à–∏–±–∫–∞: <span th:text="${param.error}"></span>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö</h5>
                    <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã.</p>

                    <div class="d-grid gap-2">
                        <form action="/analysis/start" method="post">
                            <button type="submit" class="btn btn-success w-100 mb-2">
                                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                            </button>
                        </form>
                        <form action="/commands/analysis/cancel" method="post" class="d-inline">
                            <button type="submit" class="btn btn-danger w-100">
                                ‚õî –û—Ç–º–µ–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã</h5>
                    <p class="card-text">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ REST API.</p>

                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="executeCommand('/api/solutions/commands/analyze', 'POST')">
                            üìà –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                        </button>
                        <button class="btn btn-outline-primary" onclick="executeCommand('/api/solutions/commands/solution', 'POST')">
                            üí° –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-outline-primary" onclick="executeCommand('/api/solutions/commands/response', 'POST')">
                            üí¨ –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç
                        </button>
                        <button class="btn btn-outline-warning" onclick="executeCommand('/api/solutions/commands/all', 'POST')">
                            üîÑ –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üõë –ö–æ–º–∞–Ω–¥—ã –æ—Ç–º–µ–Ω—ã</h5>
                    <p class="card-text">–û—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –∫–æ–º–∞–Ω–¥.</p>

                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-danger" onclick="executeCommand('/api/solutions/commands/analyze', 'DELETE')">
                            ‚õî –û—Ç–º–µ–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                        </button>
                        <button class="btn btn-outline-danger" onclick="executeCommand('/api/solutions/commands/solution', 'DELETE')">
                            ‚õî –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-outline-danger" onclick="executeCommand('/api/solutions/commands/response', 'DELETE')">
                            ‚õî –û—Ç–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç
                        </button>
                        <button class="btn btn-outline-danger" onclick="executeCommand('/api/solutions/commands/all', 'DELETE')">
                            ‚õî –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üìã –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h5>
                    <p class="card-text">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫–æ–º–∞–Ω–¥.</p>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–°—Ç–∞—Ç—É—Å –∞–Ω–∞–ª–∏–∑–∞:</span>
                            <span id="analysisStatus" class="badge bg-secondary">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–°—Ç–∞—Ç—É—Å —Ä–µ—à–µ–Ω–∏—è:</span>
                            <span id="solutionStatus" class="badge bg-secondary">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:</span>
                            <span id="responseStatus" class="badge bg-secondary">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                        </li>
                    </ul>

                    <div class="mt-3">
                        <button class="btn btn-info w-100" onclick="checkSystemStatus()">
                            üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">üìú –ñ—É—Ä–Ω–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h5>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ö–æ–º–∞–Ω–¥–∞</th>
                        <th>–¢–∏–ø</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                    </tr>
                    </thead>
                    <tbody id="commandLog">
                    <!-- –õ–æ–≥ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let commandLog = [];

    function executeCommand(url, method) {
        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã');
                }
                return response.json();
            })
            .then(data => {
                addToLog({
                    time: new Date().toLocaleTimeString(),
                    command: url,
                    type: method,
                    status: '–£—Å–ø–µ—à–Ω–æ',
                    result: data.message || '–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞'
                });
                alert('–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: ' + (data.message || '–£—Å–ø–µ—à–Ω–æ'));
            })
            .catch(error => {
                addToLog({
                    time: new Date().toLocaleTimeString(),
                    command: url,
                    type: method,
                    status: '–û—à–∏–±–∫–∞',
                    result: error.message
                });
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            });
    }

    function addToLog(entry) {
        commandLog.unshift(entry);
        if (commandLog.length > 10) {
            commandLog.pop();
        }
        updateLogTable();
    }

    function updateLogTable() {
        const tbody = document.getElementById('commandLog');
        tbody.innerHTML = '';

        commandLog.forEach(entry => {
            const row = document.createElement('tr');
            const statusClass = entry.status === '–£—Å–ø–µ—à–Ω–æ' ? 'success' : 'danger';

            row.innerHTML = `
                <td>${entry.time}</td>
                <td><small>${entry.command}</small></td>
                <td><span class="badge bg-info">${entry.type}</span></td>
                <td><span class="badge bg-${statusClass}">${entry.status}</span></td>
                <td>${entry.result}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function checkSystemStatus() {
        document.getElementById('analysisStatus').className = 'badge bg-warning';
        document.getElementById('solutionStatus').className = 'badge bg-warning';
        document.getElementById('responseStatus').className = 'badge bg-warning';
        document.getElementById('analysisStatus').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
        document.getElementById('solutionStatus').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
        document.getElementById('responseStatus').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';

        setTimeout(() => {
            document.getElementById('analysisStatus').className = 'badge bg-success';
            document.getElementById('solutionStatus').className = 'badge bg-success';
            document.getElementById('responseStatus').className = 'badge bg-success';
            document.getElementById('analysisStatus').textContent = '–ì–æ—Ç–æ–≤';
            document.getElementById('solutionStatus').textContent = '–ì–æ—Ç–æ–≤';
            document.getElementById('responseStatus').textContent = '–ì–æ—Ç–æ–≤';

            addToLog({
                time: new Date().toLocaleTimeString(),
                command: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è',
                type: 'GET',
                status: '–£—Å–ø–µ—à–Ω–æ',
                result: '–í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç'
            });
        }, 1000);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∞
    addToLog({
        time: new Date().toLocaleTimeString(),
        command: '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞',
        type: 'GET',
        status: '–£—Å–ø–µ—à–Ω–æ',
        result: '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ'
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>